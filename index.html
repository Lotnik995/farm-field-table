<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Work</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Daily Work</h1>
      <div class="nav">
        <a href="index.html">Daily Work</a> |
        <a href="daily-report.html">Daily Report</a>
      </div>
    </header>

    <div class="card">
      <div class="form-row">
        <label for="inputDate">Date</label>
        <input id="inputDate" type="date" />
      </div>

      <div class="form-row">
        <label for="inputField">Field</label>
        <input id="inputField" type="text" placeholder="Field ID (e.g., R-01)" />
      </div>

      <div class="form-row">
        <label for="inputBlend">Blend</label>
        <input id="inputBlend" type="text" placeholder="Blend" />
      </div>

      <!-- Rate Type Selection (Normal / N-Sensor) -->
      <div class="form-row">
        <label for="inputRateType">Rate Type</label>
        <select id="inputRateType">
          <option value="normal">Normal (kg/ha)</option>
          <option value="nsensor">N-Sensor (manual total kg)</option>
        </select>
      </div>

      <div class="form-row" id="rateRow">
        <label for="inputRate">Rate (kg/ha)</label>
        <input id="inputRate" type="number" placeholder="e.g. 250" />
      </div>

      <div class="form-row">
        <label for="inputSize">Size (ha)</label>
        <input id="inputSize" type="number" placeholder="e.g. 9" />
      </div>

      <!-- N-Sensor: Manual Total KG input -->
      <div class="form-row" id="manualTotalRow" style="display:none;">
        <label for="inputTotal">Total KG</label>
        <input id="inputTotal" type="number" placeholder="Manual Total KG" />
      </div>

      <button id="addBtn" class="btn-primary">Add to Report</button>

      <div id="addResult" style="margin-top:12px;color:var(--muted);display:none"></div>
    </div>
  </div>

<script src="app.js"></script>
<script>
  (function(){
    const dateEl = document.getElementById('inputDate');
    const fieldEl = document.getElementById('inputField');
    const blendEl = document.getElementById('inputBlend');
    const rateEl = document.getElementById('inputRate');
    const rateTypeEl = document.getElementById('inputRateType');
    const sizeEl = document.getElementById('inputSize');
    const manualTotalEl = document.getElementById('inputTotal');
    const addBtn = document.getElementById('addBtn');
    const addResult = document.getElementById('addResult');
    const rateRow = document.getElementById('rateRow');
    const manualTotalRow = document.getElementById('manualTotalRow');

    // Set date to today (ISO)
    function isoToday(){ return new Date().toISOString().slice(0,10); }
    dateEl.value = isoToday();

    // Toggle visibility based on rate type
    rateTypeEl.addEventListener('change', function() {
      if (this.value === 'nsensor') {
        rateRow.style.display = 'none';
        manualTotalRow.style.display = 'block';
      } else {
        rateRow.style.display = 'block';
        manualTotalRow.style.display = 'none';
      }
    });

    addBtn.addEventListener('click', () => {
      const date = dateEl.value;
      const field = fieldEl.value.trim();
      const blend = blendEl.value.trim();
      const rateType = rateTypeEl.value;
      const rate = rateType === 'normal' ? Number(rateEl.value) || 0 : 0;
      const size = Number(sizeEl.value) || 0;
      const total = rateType === 'normal' ? rate * size : Number(manualTotalEl.value) || 0;

      // Check if required fields are filled
      if (!date || !field) {
        addResult.style.display = 'block';
        addResult.textContent = 'Please enter date and field.';
        return;
      }

      const job = { date, field, blend, rateType, rate, size, total };
      window.FarmApp.addJob(job);

      addResult.style.display = 'block';
      addResult.textContent = `Saved ✓ — ${field} ${size} ha`;

      // Clear the input fields (except for rate/blend/field)
      sizeEl.value = '';
      manualTotalEl.value = '';

      // small flash
      setTimeout(() => addResult.style.display = 'none', 1400);
    });

  })();
</script>
</body>
</html>
