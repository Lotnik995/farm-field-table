<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Report</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --blue:#0b76c3;
    --yellow:#ffdd3c;
    --muted:#666;
  }

  *{
    box-sizing:border-box;
    font-family:Inter,system-ui,-apple-system;
  }

  body{
    margin:0;
    background:#eef2f5;
    color:#111;
  }

  .page{
    max-width:1200px;
    margin:25px auto;
    padding:18px;
  }

  header h1{
    text-align:center;
    margin-bottom:10px;
  }

  .nav{
    text-align:center;
    margin-bottom:18px;
  }
  .nav a{
    color:var(--blue);
    font-weight:700;
    text-decoration:none;
    margin:0 6px;
  }

  .card{
    background:#fff;
    border-radius:12px;
    padding:20px;
    box-shadow:0 8px 18px rgba(0,0,0,0.08);
  }

  .report-top{
    text-align:center;
    margin-bottom:12px;
  }
  .report-top h2{
    margin:4px 0;
    font-size:26px;
  }
  .date-line{
    color:var(--muted);
    font-weight:700;
  }

  /* SCREEN TABLE */
  .table-wrap{
    overflow:auto;
    border-radius:8px;
  }
  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    min-width:720px;
  }
  thead th{
    background:var(--blue);
    color:#fff;
    padding:12px;
    text-align:left;
    font-size:14px;
  }
  tbody td{
    padding:12px;
    border-bottom:1px solid #ddd;
  }
  .unit{
    color:#777;
    font-size:12px;
    margin-left:4px;
  }

  .btn{
    padding:7px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
  }
  .btn-edit{ background:#f6c85f; }
  .btn-del{ background:#ff6b6b; color:#fff; }

  .controls{
    margin-top:18px;
    text-align:center;
  }
  .btn-main{
    background:var(--blue);
    color:white;
    padding:10px 18px;
    border-radius:8px;
    border:none;
    font-weight:700;
  }
  .btn-ghost{
    background:#333;
    color:white;
    padding:10px 18px;
    border-radius:8px;
    border:none;
  }

  /* PRINT */
  @media print{
    body{ background:#fff; }

    .nav, .controls, .btn, .screen-table{ display:none!important; }

    .card{
      box-shadow:none;
      padding:0;
    }

    .print-table{ display:block!important; margin-top:10px; }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
    }

    thead.print-head th{
      background:var(--yellow) !important;
      color:#000 !important;
      border:1px solid #000;
      padding:6px;
      text-align:center;
    }

    .print-table td{
      border:1px solid #000;
      padding:6px;
    }

    @page{
      size:A4 portrait;
      margin:10mm;
    }
  }

  .print-table{ display:none; }

</style>
</head>
<body>

<div class="page">
  <header>
    <h1>Daily Report</h1>
    <div class="nav">
      <a href="index.html">Daily Work</a> |
      <a href="daily-report.html">Daily Report</a>
    </div>
  </header>

  <div class="card">
    <div class="report-top">
      <h2>Daily Report</h2>
      <div class="date-line">
        Report for: <span id="printDateDisplay">—</span>
      </div>
    </div>

    <!-- SCREEN TABLE -->
    <div class="table-wrap screen-table">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Field</th>
            <th>Blend</th>
            <th>Rate</th>
            <th>Size</th>
            <th>Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="screenBody"></tbody>
      </table>
    </div>

    <!-- PRINT TABLE -->
    <div class="print-table">
      <table>
        <thead class="print-head">
          <tr>
            <th>Field ID</th>
            <th>Fert Blend</th>
            <th>Rate (kg/ha)</th>
            <th>Size (ha)</th>
            <th>Total (kg)</th>
          </tr>
        </thead>
        <tbody id="printBody"></tbody>
      </table>
    </div>

    <div id="totalsLine" style="margin-top:12px;font-weight:700;"></div>

    <div class="controls">
      <button class="btn-main" id="printBtn">Print</button>
      <button class="btn-ghost" id="exportCsvBtn">Export CSV</button>
    </div>

  </div>
</div>

<script>
/* LOAD + SAVE */
function loadJobs(){
  try { return JSON.parse(localStorage.getItem("jobs")||"[]"); }
  catch(e){ return []; }
}
function saveJobs(j){ localStorage.setItem("jobs",JSON.stringify(j)); }

/* Format helper */
function fmt(n,d=0){
  if(isNaN(n)) return n;
  return Number(n).toLocaleString(undefined,{
    minimumFractionDigits:d,
    maximumFractionDigits:d
  });
}
function escapeHtml(s){
  return String(s||"").replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;","<": "&lt;",">":"&gt;","\"":"&quot;"}[m]));
}

/* RENDER */
function render(){
  const jobs = loadJobs();
  const sBody = document.getElementById("screenBody");
  const pBody = document.getElementById("printBody");
  const dateDisp = document.getElementById("printDateDisplay");
  const totalsLine = document.getElementById("totalsLine");

  sBody.innerHTML = "";
  pBody.innerHTML = "";

  if(!jobs.length){
    totalsLine.textContent = "Totals: 0 ha — 0 kg";
    return;
  }

  dateDisp.textContent = jobs[0].date;

  let totalHa = 0, totalKg = 0;

  jobs.forEach((job, idx)=>{
    const rate = Number(job.rate)||0;
    const size = Number(job.size)||0;
    const total = Number(job.total)||rate*size;

    totalHa += size;
    totalKg += total;

    /* SCREEN row */
    sBody.innerHTML += `
      <tr>
        <td>${job.date}</td>
        <td>${escapeHtml(job.field)}</td>
        <td>${escapeHtml(job.blend)}</td>
        <td>${fmt(rate)} <span class="unit">kg/ha</span></td>
        <td>${fmt(size)} <span class="unit">ha</span></td>
        <td>${fmt(total)} <span class="unit">kg</span></td>
        <td>
          <button class="btn btn-edit" onclick="editJob(${idx})">Edit</button>
          <button class="btn btn-del" onclick="deleteJob(${idx})">Delete</button>
        </td>
      </tr>`;

    /* PRINT row */
    pBody.innerHTML += `
      <tr>
        <td>${escapeHtml(job.field)}</td>
        <td>${escapeHtml(job.blend)}</td>
        <td>${fmt(rate)} kg/ha</td>
        <td>${fmt(size)} ha</td>
        <td>${fmt(total)} kg</td>
      </tr>`;
  });

  totalsLine.textContent =
    "Totals: " + fmt(totalHa,2) + " ha → " + fmt(totalKg,2) + " kg";
}

/* EDIT */
function editJob(i){
  const jobs = loadJobs();
  const j = jobs[i];
  if(!j) return;

  const nf = prompt("Field:", j.field); if(nf===null) return;
  const ns = prompt("Size (ha):", j.size); if(ns===null) return;
  const nr = prompt("Rate (kg/ha):", j.rate); if(nr===null) return;

  j.field = nf;
  j.size = Number(ns)||0;
  j.rate = Number(nr)||0;
  j.total = j.size*j.rate;

  jobs[i] = j;
  saveJobs(jobs);
  render();
}

/* DELETE */
function deleteJob(i){
  if(!confirm("Delete?")) return;
  const jobs = loadJobs();
  jobs.splice(i,1);
  saveJobs(jobs);
  render();
}

/* EXPORT CSV */
document.getElementById("exportCsvBtn").onclick = function(){
  const jobs = loadJobs();
  let csv = "Date,Field,Blend,Rate,Size,Total\n";
  jobs.forEach(j=>{
    csv+=`${j.date},${j.field},${j.blend},${j.rate},${j.size},${j.total}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="daily-report.csv";
  a.click();
};

/* PRINT */
document.getElementById("printBtn").onclick = ()=>{ 
  setTimeout(()=>print(),150); 
};

render();
</script>

</body>
</html>
