<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Report</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --blue:#0984d6;
    --muted:#6b7280;
    --yellow:#ffdd3c;
  }

  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system;}

  body{
    margin:0;
    background:#f3f4f6;
    color:#111;
  }

  .page{
    max-width:1200px;
    margin:28px auto;
    padding:18px;
  }

  header h1{
    text-align:center;
    font-size:34px;
    margin:6px 0;
  }

  .nav{text-align:center;margin-bottom:18px;}
  .nav a{color:var(--blue);text-decoration:none;font-weight:600;margin:0 8px;}

  .card{
    background:#fff;
    padding:18px;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
  }

  .report-top{
    text-align:center;
    margin-bottom:14px;
  }
  .report-top h2{margin:6px 0;font-size:26px;}
  .date-line{color:#555;font-weight:700;}

  /* SCREEN TABLE (unchanged except date removed) */
  .table-wrap{overflow:auto;border-radius:10px;}
  table{width:100%;border-collapse:collapse;min-width:720px;}
  thead th{
    background:#0b76c3;
    color:white;
    padding:14px;
    text-align:left;
    font-size:14px;
  }
  tbody td{
    border-bottom:1px solid #e5e5e5;
    padding:14px;
  }
  .unit{color:#888;font-size:12px;margin-left:4px;}

  .btn{padding:8px 12px;font-size:13px;border-radius:8px;cursor:pointer;font-weight:700;}
  .btn-edit{background:#f6c85f;}
  .btn-del{background:#ff6b6b;color:#fff;}

  .controls{text-align:center;margin-top:18px;}
  .btn-main{background:var(--blue);color:#fff;border:none;padding:10px 18px;border-radius:8px;font-weight:700;}
  .btn-ghost{background:#333;color:#fff;border:none;padding:10px 18px;border-radius:8px;}

  /* ---------------- PRINT ONLY ---------------- */
  @media print{
    body{background:#fff;}
    .nav, .controls, .btn, .screen-table {display:none!important;}

    .card{box-shadow:none;padding:0;}

    .print-table{display:block!important;margin-top:10px;}

    table{width:100%;border-collapse:collapse;font-size:11px;}

    thead.print-head th{
      background:var(--yellow)!important;
      color:#000!important;
      border:1px solid #000;
      padding:6px;
      text-align:center;
      font-weight:700;
    }

    .print-table td{
      border:1px solid #000;
      padding:6px;
    }

    @page {
      size: A4 portrait;
      margin:10mm;
    }
  }

  .print-table{display:none;}
</style>
</head>

<body>
<div class="page">
  <header>
    <h1>Daily Report</h1>
    <div class="nav">
      <a href="index.html">Daily Work</a> |
      <a href="daily-report.html">Daily Report</a>
    </div>
  </header>

  <div class="card">

    <div class="report-top">
      <h2>Daily Report</h2>
      <div class="date-line">Report for: <span id="printDateDisplay">—</span></div>
    </div>

    <!-- SCREEN TABLE (Date removed) -->
    <div class="table-wrap screen-table">
      <table>
        <thead>
          <tr>
            <th>Field</th>
            <th>Blend</th>
            <th>Rate</th>
            <th>Size</th>
            <th>Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="screenBody"></tbody>
      </table>
    </div>

    <!-- PRINT TABLE (Yellow header, units in each row) -->
    <div class="print-table">
      <table>
        <thead class="print-head">
          <tr>
            <th>Field ID</th>
            <th>Fert Blend</th>
            <th>Rate (kg/ha)</th>
            <th>Field Size (ha)</th>
            <th>Total KG</th>
          </tr>
        </thead>
        <tbody id="printBody"></tbody>
      </table>
    </div>

    <div id="totalsLine" style="margin-top:12px;font-weight:700;"></div>

    <div class="controls">
      <button class="btn-main" id="printBtn">Print</button>
      <button class="btn-ghost" id="exportCsvBtn">Export CSV</button>
    </div>

  </div>
</div>

<script>
function loadJobs(){
  try { return JSON.parse(localStorage.getItem("jobs")||"[]"); }
  catch(e){ return []; }
}

function saveJobs(j){ localStorage.setItem("jobs",JSON.stringify(j)); }

function fmt(n,d=0){
  if(isNaN(n)) return n;
  return Number(n).toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});
}

function escapeHtml(s){
  return String(s||"").replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m]));
}

function render(){
  const jobs = loadJobs();
  const sBody = document.getElementById("screenBody");
  const pBody = document.getElementById("printBody");
  const dateDisp = document.getElementById("printDateDisplay");
  const totalsLine = document.getElementById("totalsLine");

  sBody.innerHTML = "";
  pBody.innerHTML = "";

  if(!jobs.length){
    totalsLine.textContent = "Totals: 0 ha — 0 kg";
    return;
  }

  dateDisp.textContent = jobs[0].date;

  let totalHa = 0, totalKg = 0;

  jobs.forEach((job, idx)=>{
    const rate = Number(job.rate)||0;
    const size = Number(job.size)||0;
    const total = Number(job.total)||rate*size;

    totalHa += size;
    totalKg += total;

    /* SCREEN row (no date column) */
    sBody.innerHTML += `
      <tr>
        <td>${escapeHtml(job.field)}</td>
        <td>${escapeHtml(job.blend)}</td>
        <td>${fmt(rate)} <span class="unit">kg/ha</span></td>
        <td>${fmt(size)} <span class="unit">ha</span></td>
        <td>${fmt(total)} <span class="unit">kg</span></td>
        <td>
          <button class="btn btn-edit" onclick="editJob(${idx})">Edit</button>
          <button class="btn btn-del" onclick="deleteJob(${idx})">Delete</button>
        </td>
      </tr>`;

    /* PRINT row (units added!) */
    pBody.innerHTML += `
      <tr>
        <td>${escapeHtml(job.field)}</td>
        <td>${escapeHtml(job.blend)}</td>
        <td>${fmt(rate)} kg/ha</td>
        <td>${fmt(size)} ha</td>
        <td>${fmt(total)} kg</td>
      </tr>`;
  });

  totalsLine.textContent =
    "Totals: " + fmt(totalHa,2) + " ha → " + fmt(totalKg,2) + " kg";
}

function editJob(i){
  const jobs = loadJobs();
  const j = jobs[i];
  if(!j) return;

  const nf = prompt("Field:", j.field); if(nf===null) return;
  const ns = prompt("Size (ha):", j.size); if(ns===null) return;
  const nr = prompt("Rate (kg/ha):", j.rate); if(nr===null) return;

  j.field = nf;
  j.size = Number(ns)||0;
  j.rate = Number(nr)||0;
  j.total = j.size*j.rate;

  jobs[i]=j;
  saveJobs(jobs);
  render();
}

function deleteJob(i){
  if(!confirm("Delete?")) return;
  const jobs = loadJobs();
  jobs.splice(i,1);
  saveJobs(jobs);
  render();
}

document.getElementById("exportCsvBtn").onclick = function(){
  const jobs = loadJobs();
  let csv = "Field,Blend,Rate,Size,Total\n";
  jobs.forEach(j=>{
    csv+=`${j.field},${j.blend},${j.rate},${j.size},${j.total}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="daily-report.csv";
  a.click();
};

document.getElementById("printBtn").onclick = ()=>{ setTimeout(()=>print(),150); };

render();
</script>

</body>
</html>
