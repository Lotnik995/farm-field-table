<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Report</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --blue:#0984d6;
    --muted:#6b7280;
    --table-head:#fdd835;      /* YELLOW HEADER */
    --accent:#ff8c42;
    --danger:#ff4d4f;
  }

  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}

  body{
    margin:0;
    background:#f3f4f6;
    color:#111827;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .page {
    max-width:1200px;
    margin:28px auto;
    padding:18px;
  }

  header h1{
    text-align:center;
    margin:8px 0 6px 0;
    font-weight:700;
    font-size:34px;
  }

  .nav{
    text-align:center;
    margin:6px 0 20px;
  }
  .nav a{ color:var(--blue); text-decoration:none; margin:0 8px; font-weight:600; }

  .card{
    background:#fff;
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 18px rgba(15,23,42,0.06);
  }

  .report-top{
    text-align:center;
    padding:6px 8px;
    margin-bottom:12px;
  }
  .report-top .title h2{ margin:6px 0; font-size:26px; font-weight:700; }
  .report-top .date { color:var(--muted); font-weight:600; }

  /* SCREEN TABLE */
  .table-wrap {
    overflow:auto;
    border-radius:8px;
  }
  table {
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    font-size:15px;
    min-width:720px;
  }
  thead th{
    background:var(--table-head);
    color:#111;
    padding:14px 12px;
    font-weight:700;
    text-align:left;
    border-bottom:2px solid #ccc;
  }
  tbody td{
    border-bottom:1px solid #efefef;
    padding:14px 12px;
    vertical-align:middle;
    color:#111827;
  }

  .unit { color:var(--muted); font-size:12px; display:inline-block; margin-left:6px; }

  .btn {
    display:inline-block;
    padding:8px 12px;
    border-radius:8px;
    text-decoration:none;
    cursor:pointer;
    font-weight:700;
    font-size:13px;
  }
  .btn-edit{ background:#f6c85f; color:#111; }
  .btn-del{ background:#ff6b6b; color:#fff; margin-left:8px; }

  .controls{
    text-align:center;
    margin-top:18px;
    display:flex;
    gap:12px;
    justify-content:center;
    flex-wrap:wrap;
  }
  .btn-main{ background:var(--blue); color:#fff; padding:10px 18px; border-radius:8px; border:none; font-weight:700; }
  .btn-ghost{ background:#333; color:#fff; border:none; padding:10px 18px; border-radius:8px; }

  /* MOBILE */
  @media (max-width:640px){
    .page{ padding:12px; }
    table{ min-width:640px; } /* allow pinch zoom */
    .report-top .title h2{ font-size:22px; }
  }

  /* PRINT STYLE */
  @media print{
    body{ background:#fff; color:#000; }
    .page{ max-width:780px; margin:0 auto; padding:8mm; }
    .nav, .controls, .btn, .btn-edit, .btn-del { display:none !important; }
    .card { box-shadow:none; border-radius:0; padding:0; }
    .screen-table { display:none !important; }
    .print-table { display:block !important; width:100%; }

    .print-table table {
      width:100%;
      border-collapse:collapse;
      font-size:12px;
    }
    .print-table thead th {
      background:#000;
      color:#fff;
      padding:6px;
      border:1px solid #000;
    }
    .print-table td {
      border:1px solid #000;
      padding:6px;
    }

    @page { size:A4 portrait; margin:10mm; }
  }

  .print-table{ display:none; }

  .totals {
    margin-top:12px;
    font-weight:700;
    color:#111827;
  }
</style>
</head>
<body>

<div class="page">
  <header>
    <h1>Daily Report</h1>
    <div class="nav">
      <a href="index.html">Daily Work</a> |
      <a href="daily-report.html">Daily Report</a>
    </div>
  </header>

  <div class="card">

    <div class="report-top">
      <div class="title"><h2>Daily Report</h2></div>
      <div class="date" id="reportDateDisplay">Report for: <span id="displayDate">—</span></div>
    </div>

    <!-- SCREEN TABLE -->
    <div class="table-wrap screen-table">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Field</th>
            <th>Blend</th>
            <th>Rate</th>
            <th>Size</th>
            <th>Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="screenBody"></tbody>
      </table>
    </div>

    <!-- PRINT TABLE -->
    <div class="print-table">
      <table id="printTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Field</th>
            <th>Blend</th>
            <th>Rate</th>
            <th>Size</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="printBody"></tbody>
      </table>
    </div>

    <div class="totals" id="totalsLine">Totals: 0 ha — 0 kg</div>

    <div class="controls">
      <button class="btn-main" id="printBtn">Print</button>
      <button class="btn-ghost" id="exportCsvBtn">Export CSV</button>
    </div>

  </div>
</div>

<script>
(function(){
  const screenBody = document.getElementById("screenBody");
  const printBody = document.getElementById("printBody");
  const totalsLine = document.getElementById("totalsLine");
  const displayDate = document.getElementById("displayDate");

  function loadJobs(){
    try {
      return JSON.parse(localStorage.getItem("jobs") || "[]");
    } catch {
      return [];
    }
  }

  function saveJobs(jobs){
    localStorage.setItem("jobs", JSON.stringify(jobs));
  }

  function fmt(n){ return Number(n).toLocaleString(); }

  function render(){
    const jobs = loadJobs();
    screenBody.innerHTML = "";
    printBody.innerHTML = "";

    if(jobs.length === 0){
      displayDate.textContent = "—";
      totalsLine.textContent = "Totals: 0 ha — 0 kg";
      return;
    }

    displayDate.textContent = jobs[0].date;

    let totalHa = 0;
    let totalKg = 0;

    jobs.forEach((job, idx) => {
      const rate = Number(job.rate) || 0;
      const size = Number(job.size) || 0;
      const total = Number(job.total) || rate * size;

      totalHa += size;
      totalKg += total;

      screenBody.innerHTML += `
      <tr>
        <td>${job.date}</td>
        <td>${job.field}</td>
        <td>${job.blend}</td>
        <td>${rate} <span class="unit">kg/ha</span></td>
        <td>${size} <span class="unit">ha</span></td>
        <td>${fmt(total)} <span class="unit">kg</span></td>
        <td>
          <button class="btn-edit" data-i="${idx}">Edit</button>
          <button class="btn-del" data-i="${idx}">Delete</button>
        </td>
      </tr>`;

      printBody.innerHTML += `
      <tr>
        <td>${job.date}</td>
        <td>${job.field}</td>
        <td>${job.blend}</td>
        <td>${rate} kg/ha</td>
        <td>${size} ha</td>
        <td>${fmt(total)} kg</td>
      </tr>`;
    });

    totalsLine.textContent = `Totals: ${totalHa.toFixed(2)} ha — ${fmt(totalKg)} kg`;

    // Delete
    document.querySelectorAll(".btn-del").forEach(btn => {
      btn.onclick = () => {
        const i = Number(btn.dataset.i);
        const jobs = loadJobs();
        jobs.splice(i,1);
        saveJobs(jobs);
        render();
      };
    });

    // Edit
    document.querySelectorAll(".btn-edit").forEach(btn => {
      btn.onclick = () => {
        const i = Number(btn.dataset.i);
        const jobs = loadJobs();
        const job = jobs[i];

        const f = prompt("Field?", job.field);
        if(f===null) return;

        const s = prompt("Size?", job.size);
        if(s===null) return;

        const r = prompt("Rate?", job.rate);
        if(r===null) return;

        job.field = f;
        job.size = Number(s);
        job.rate = Number(r);
        job.total = job.rate * job.size;

        saveJobs(jobs);
        render();
      };
    });
  }

  // CSV Export
  document.getElementById("exportCsvBtn").onclick = () => {
    const jobs = loadJobs();
    if(jobs.length===0){ alert("No data"); return; }

    const lines = [["Date","Field","Blend","Rate","Size","Total"]];
    jobs.forEach(j => lines.push([j.date,j.field,j.blend,j.rate,j.size,j.total]));

    const csv = lines.map(r=>r.join(",")).join("\n");
    const blob = new Blob([csv],{type:"text/csv"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "daily-report.csv";
    a.click();
    URL.revokeObjectURL(url);
  };

  document.getElementById("printBtn").onclick = () => {
    render();
    setTimeout(()=>window.print(),200);
  };

  render();
})();
</script>

</body>
</html>
