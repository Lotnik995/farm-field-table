<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Report</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --blue:#0984d6;
    --muted:#6b7280;
    --table-head:#0b76c3;
    --accent:#ff8c42;
    --danger:#ff4d4f;
  }

  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}

  body{
    margin:0;
    background:#f3f4f6;
    color:#111827;
  }

  .page {
    max-width:1200px;
    margin:28px auto;
    padding:18px;
  }

  header h1{
    text-align:center;
    margin:8px 0 6px 0;
    font-weight:700;
    font-size:34px;
  }

  .nav{
    text-align:center;
    margin:6px 0 20px;
  }
  .nav a{ color:var(--blue); text-decoration:none; margin:0 8px; font-weight:600; }

  .card{
    background:#fff;
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 18px rgba(15,23,42,0.06);
  }

  .report-top{
    text-align:center;
    margin-bottom:12px;
  }
  .report-top h2{ margin:6px 0; font-size:24px; font-weight:700; }
  .report-top .date{
    margin-top:4px;
    color:#555;
    font-weight:600;
  }

  .table-wrap {
    overflow:auto;
  }

  table {
    width:100%;
    border-collapse:collapse;
    font-size:15px;
  }

  thead th{
    background:var(--table-head);
    color:#fff;
    padding:10px;
    text-align:left;
    font-weight:700;
  }

  tbody td{
    padding:8px 10px;
    border-bottom:1px solid #e5e5e5;
  }

  .unit{
    font-size:11px;
    color:#666;
    margin-left:4px;
  }

  .btn{
    padding:6px 10px;
    font-size:12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
  }
  .btn-edit{ background:#f6c85f; }
  .btn-del{ background:#ff6b6b; color:#fff; margin-left:6px; }

  .totals{
    font-weight:700;
    margin-top:12px;
    font-size:16px;
  }

  .controls{
    margin-top:20px;
    text-align:center;
  }
  .controls button{
    padding:10px 14px;
    margin:0 6px;
    border:none;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
  }
  .btn-main{ background:var(--blue); color:#fff; }
  .btn-ghost{ background:#333; color:#fff; }

  /* PRINT MODE */
  @media print{
    body{ background:#fff; }
    .nav, .controls, .btn-edit, .btn-del{ display:none !important; }
    .card{ box-shadow:none; padding:0; }
    .screen-table{ display:none!important; }
    .print-table{ display:block!important; }

    table{
      border-collapse:collapse;
      font-size:11px;
    }

    th,td{
      border:1px solid #000;
      padding:5px;
    }

    @page { size:A4 portrait; margin:10mm; }
  }

  .print-table{ display:none; }

</style>
</head>
<body>

<div class="page">

<header>
  <h1>Daily Report</h1>
  <div class="nav">
    <a href="index.html">Daily Work</a> |
    <a href="daily-report.html">Daily Report</a>
  </div>
</header>

<div class="card">

  <div class="report-top">
    <h2>Daily Report</h2>
    <div class="date">Report for: <span id="displayDate">—</span></div>
  </div>

  <!-- SCREEN TABLE -->
  <div class="table-wrap screen-table">
    <table>
      <thead>
        <tr>
          <th>Field ID</th>
          <th>Fert Blend</th>
          <th>Rate (kg/ha)</th>
          <th>Field Size (ha)</th>
          <th>Total KG</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="screenBody"></tbody>
    </table>
  </div>

  <!-- PRINT TABLE -->
  <div class="print-table">
    <table>
      <thead>
        <tr>
          <th>Field ID</th>
          <th>Fert Blend</th>
          <th>Rate (kg/ha)</th>
          <th>Field Size (ha)</th>
          <th>Total KG</th>
        </tr>
      </thead>
      <tbody id="printBody"></tbody>
    </table>
  </div>

  <div class="totals" id="totalsLine">Totals: 0 ha → 0 kg</div>

  <div class="controls">
    <button class="btn-main" onclick="window.print()">Print</button>
    <button class="btn-ghost" id="exportCsvBtn">Export CSV</button>
  </div>

</div>
</div>

<script>
function loadJobs(){
  try{
    return JSON.parse(localStorage.getItem("jobs")||"[]");
  }catch(e){ return []; }
}

function saveJobs(j){
  localStorage.setItem("jobs",JSON.stringify(j));
}

function fmt(n){ return Number(n).toFixed(n%1?1:0); }

function render(){
  let jobs = loadJobs();
  let sBody = document.getElementById("screenBody");
  let pBody = document.getElementById("printBody");
  let totals = document.getElementById("totalsLine");

  sBody.innerHTML = "";
  pBody.innerHTML = "";

  if(jobs.length===0){
    document.getElementById("displayDate").textContent = "—";
    totals.textContent = "Totals: 0 ha → 0 kg";
    return;
  }

  document.getElementById("displayDate").textContent = jobs[0].date;

  let totalHa = 0;
  let totalKg = 0;

  jobs.forEach((j,i)=>{
    let row = document.createElement("tr");
    row.innerHTML = `
      <td>${j.field}</td>
      <td>${j.blend}</td>
      <td>${fmt(j.rate)} <span class="unit">kg/ha</span></td>
      <td>${fmt(j.size)} <span class="unit">ha</span></td>
      <td>${fmt(j.total)} <span class="unit">kg</span></td>
      <td>
        <button class="btn btn-edit" onclick="editJob(${i})">Edit</button>
        <button class="btn btn-del" onclick="deleteJob(${i})">Delete</button>
      </td>`;
    sBody.appendChild(row);

    let prow = document.createElement("tr");
    prow.innerHTML = `
      <td>${j.field}</td>
      <td>${j.blend}</td>
      <td>${fmt(j.rate)} kg/ha</td>
      <td>${fmt(j.size)} ha</td>
      <td>${fmt(j.total)} kg</td>`;
    pBody.appendChild(prow);

    totalHa += Number(j.size);
    totalKg += Number(j.total);
  });

  totals.textContent = `Totals: ${fmt(totalHa)} ha → ${fmt(totalKg)} kg`;
}

function deleteJob(i){
  let j = loadJobs();
  j.splice(i,1);
  saveJobs(j);
  render();
}

function editJob(i){
  let j = loadJobs();
  let item = j[i];
  if(!item) return;

  let field = prompt("Field ID:", item.field); if(field===null) return;
  let size = prompt("Field size (ha):", item.size); if(size===null) return;
  let rate = prompt("Rate (kg/ha):", item.rate); if(rate===null) return;

  item.field = field;
  item.size = Number(size);
  item.rate = Number(rate);
  item.total = item.size * item.rate;

  j[i] = item;
  saveJobs(j);
  render();
}

render();
</script>

</body>
</html>
